	CPU	68000
	SUPMODE	OFF

ROM_B	EQU	$00008000
RAM_B	EQU	$00008060
STACK	EQU	$00008080

	ORG	ROM_B

START:
	LEA.L	STACK,A7
	MOVE.L	#$12345678,A6
	MOVE.L	#$33335501,SBRVAL
LOOP:
	MOVE.L	SBRVAL,-(A7)	; Push
	BSR	SBRFNC
	MOVE.L	#$FFFFFFFF,-4(A7)
	ADDQ.L	#4,A7		; Move stack(pop)
	MOVE.L	#$FFFFFFFF,-4(A7)
	MOVE.L	D0,SBRVAL
	MOVE.L	A6,D1
	ROL.L	#4,D1
	MOVEA.L	D1,A6
	BRA	LOOP
	ILLEGAL

SBRFNC:
	LINK	A6,#-8
	MOVE.L	8(A6),-8(A6)	; Get parameter
	ROL.W	-8(A6)
	EOR.B	#$FF,-6(A6)
	ADDQ.B	#1,-5(A6)
	MOVE.L	-8(A6),D0
	UNLK	A6
;	MOVE.L	#$FFFF,-12(A7)
;	MOVE.L	#$FFFF,-4(A7)
	RTS

	ORG	RAM_B
	DC.B	[STACK-*]$FF

	ORG	RAM_B

SBRVAL:	DS.L	1

END
